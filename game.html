<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>NoClue!</title>
    <meta
      name="robots"
      content="noai, noimageai"
    />
    <meta
      name="robots"
      content="noindex, follow"
    />
    <meta
      name="googlebot"
      content="noindex"
    />
    <meta
      name="googlebot"
      content="follow"
    />
    <meta
      name="googlebot-news"
      content="noindex"
    />
    <meta
      name="bingbot"
      content="noindex"
    />
    <meta
      name="duckduckbot"
      content="noindex"
    />
    <meta
      name="baiduspider"
      content="noindex"
    />
    <meta
      name="yandexbot"
      content="noindex"
    />

    <meta
      name="application-name"
      content="NoClue!"
    />
    <meta
      name="author"
      content="Veni DiVinci"
    />
    <meta
      name="description"
      content="Let's get you to win at Cluedo! Choose from numerous editions."
    />

    <link
      rel="stylesheet"
      href="code/style.css"
    />
    <script src="code/script.js"></script>
    <link
      rel="icon"
      href="design/favicon.png"
      type="image/png"
    />
    <link
      rel="shortcut icon"
      href="design/favicon.png"
      type="image/png"
    />
    <link
      rel="icon"
      href="design/favicon.ico"
      type="image/x-icon"
    />
  </head>
  <body>
    <header>
      <div class="logo-container">
        <a href="index.html">
          <img
            src="design/logo.png"
            alt="NoClue! logo"
          />
        </a>
      </div>
      <svg
        id="menu-open"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 -960 960 960"
        style="width: var(--navigacio-meret); height: var(--navigacio-meret); fill: var(--navigacio-masodlagos-szin)"
      >
        <path d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z" />
      </svg>
      <svg
        class="hidden"
        id="menu-close"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 -960 960 960"
        style="width: var(--navigacio-meret); height: var(--navigacio-meret); fill: var(--navigacio-masodlagos-szin)"
      >
        <path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z" />
      </svg>
    </header>
    <nav class="hidden">
      <ul>
        <li>
          <a href="index.html">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 -960 960 960"
            >
              <path d="M160-120v-480l320-240 320 240v480H560v-280H400v280H160Z" />
            </svg>
            Home
          </a>
        </li>
        <li>
          <a onclick='window.location.href = "mailto: info@noclue.app" + "?subject=" + encodeURIComponent("NoClue! experience")'>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 -960 960 960"
            >
              <path d="M160-160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h640q33 0 56.5 23.5T880-720v480q0 33-23.5 56.5T800-160H160Zm320-280L160-640v400h640v-400L480-440Zm0-80 320-200H160l320 200ZM160-640v-80 480-400Z" />
            </svg>
            Contact
          </a>
        </li>

        <li>
          <a href="donate.html">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 -960 960 960"
            >
              <path d="M560-440q-50 0-85-35t-35-85q0-50 35-85t85-35q50 0 85 35t35 85q0 50-35 85t-85 35ZM280-320q-33 0-56.5-23.5T200-400v-320q0-33 23.5-56.5T280-800h560q33 0 56.5 23.5T920-720v320q0 33-23.5 56.5T840-320H280Zm80-80h400q0-33 23.5-56.5T840-480v-160q-33 0-56.5-23.5T760-720H360q0 33-23.5 56.5T280-640v160q33 0 56.5 23.5T360-400Zm440 240H120q-33 0-56.5-23.5T40-240v-440h80v440h680v80ZM280-400v-320 320Z" />
            </svg>
            Donate
          </a>
        </li>

        <li>
          <a href="disclaimer.html">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 -960 960 960"
            >
              <path d="M400-320h160q17 0 28.5-11.5T600-360v-80h-80v40h-80v-160h80v40h80v-80q0-17-11.5-28.5T560-640H400q-17 0-28.5 11.5T360-600v240q0 17 11.5 28.5T400-320Zm80 240q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z" />
            </svg>
            Disclaimer
          </a>
        </li>
        <hr />
        <li id="game_menu">
          <a href="game.html">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 -960 960 960"
            >
              <path d="m272-440 208 120 208-120-168-97v137h-80v-137l-168 97Zm168-189v-17q-44-13-72-49.5T340-780q0-58 41-99t99-41q58 0 99 41t41 99q0 48-28 84.5T520-646v17l280 161q19 11 29.5 29.5T840-398v76q0 22-10.5 40.5T800-252L520-91q-19 11-40 11t-40-11L160-252q-19-11-29.5-29.5T120-322v-76q0-22 10.5-40.5T160-468l280-161Zm0 378L200-389v67l280 162 280-162v-67L520-251q-19 11-40 11t-40-11Zm40-469q25 0 42.5-17.5T540-780q0-25-17.5-42.5T480-840q-25 0-42.5 17.5T420-780q0 25 17.5 42.5T480-720Zm0 560Z" />
            </svg>
            Game Menu
          </a>
          <ul class="sublist">
            <li onclick="if (localStorage.getItem('Question')) { localStorage.removeItem('Question'); }"><a href="record-question.html">Record question</a></li>
            <li><a href="clue-sheet.html">Clue sheet</a></li>
            <li><a href="discovered-card.html">Discovered card</a></li>
            <li id="torles"><a href="delete-question.html">Delete question</a></li>
          </ul>
        </li>
        <hr />
      </ul>
      <div id="settings">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 -960 960 960"
        >
          <path d="m370-80-16-128q-13-5-24.5-12T307-235l-119 50L78-375l103-78q-1-7-1-13.5v-27q0-6.5 1-13.5L78-585l110-190 119 50q11-8 23-15t24-12l16-128h220l16 128q13 5 24.5 12t22.5 15l119-50 110 190-103 78q1 7 1 13.5v27q0 6.5-2 13.5l103 78-110 190-118-50q-11 8-23 15t-24 12L590-80H370Zm70-80h79l14-106q31-8 57.5-23.5T639-327l99 41 39-68-86-65q5-14 7-29.5t2-31.5q0-16-2-31.5t-7-29.5l86-65-39-68-99 42q-22-23-48.5-38.5T533-694l-13-106h-79l-14 106q-31 8-57.5 23.5T321-633l-99-41-39 68 86 64q-5 15-7 30t-2 32q0 16 2 31t7 30l-86 65 39 68 99-42q22 23 48.5 38.5T427-266l13 106Zm42-180q58 0 99-41t41-99q0-58-41-99t-99-41q-59 0-99.5 41T342-480q0 58 40.5 99t99.5 41Zm-2-140Z" />
        </svg>
        Settings
        <br />
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 -960 960 960"
        >
          <path d="m476-80 182-480h84L924-80h-84l-43-122H603L560-80h-84ZM160-200l-56-56 202-202q-35-35-63.5-80T190-640h84q20 39 40 68t48 58q33-33 68.5-92.5T484-720H40v-80h280v-80h80v80h280v80H564q-21 72-63 148t-83 116l96 98-30 82-122-125-202 201Zm468-72h144l-72-204-72 204Z" />
        </svg>
        <select id="languages"></select>

        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 -960 960 960"
        >
          <path d="M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm40-83q119-15 199.5-104.5T800-480q0-123-80.5-212.5T520-797v634Z" />
        </svg>
        <select id="theme">
          <option value="1">Light</option>
          <option value="2">Dark</option>
        </select>
      </div>
    </nav>
    <article>
      <h2 id="dinamikus_szoveg"></h2>
      <div id="step0"></div>
      <div id="step1"></div>
      <div class="draggable">
        <h3>Name</h3>
        <h3>No. of cards</h3>
      </div>

      <div id="step2"></div>
      <div
        id="step3"
        class="single-column"
      ></div>

      <div id="step4">
        <div
          class="tile"
          onclick="if (localStorage.getItem('Question')) { localStorage.removeItem('Question'); } window.location.href='record-question.html';"
        >
          Record question
        </div>
        <div
          class="tile"
          onclick="window.location.href='clue-sheet.html'"
        >
          Clue sheet
        </div>
        <div
          class="tile"
          onclick="window.location.href='discovered-card.html'"
        >
          Discovered card
        </div>
        <div
          class="tile"
          onclick="window.location.href='delete-question.html'"
        >
          Delete question
        </div>
      </div>
    </article>
    <div id="buttons">
      <button class="navigation-button">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 -960 960 960"
          style="width: var(--navigacio-meret); height: var(--navigacio-meret); fill: var(--navigacio-masodlagos-szin)"
        >
          <path d="M560-240 320-480l240-240 56 56-184 184 184 184-56 56Z" />
        </svg>
      </button>
      <button class="navigation-button">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 -960 960 960"
          style="width: var(--navigacio-meret); height: var(--navigacio-meret); fill: var(--navigacio-masodlagos-szin)"
        >
          <path d="M504-480 320-664l56-56 240 240-240 240-56-56 184-184Z" />
        </svg>
      </button>
    </div>
  </body>

  <script>
    const lepes_osszes = 4;

    window.onload = function () {
      localStorage.setItem("Editions", "Classic - US, Classic - EN, Classic - HU, Charlie and the Chocolate Factory, Scooby Doo!");
      localStorage.setItem("Player limit", [3, 4, 5, 6]);

      lepes_helper("game");
    };

    function lepes_0(command) {
      if (command == "load") {
        document.getElementById("dinamikus_szoveg").textContent = "Edition";
        document.getElementsByClassName("draggable")[0].style.display = "none";
        forditas("EN", selected_lang);
        kiadasok = localStorage.getItem("Editions").split(", ");
        kiadas = localStorage.getItem("Edition");

        div_creator(0, kiadasok, "tile");
        selection_handler(0);
        if (!kiadas) {
          button_handler_uj(2, "disabled");
        }
        if (kiadas) {
          selection_returner(0, kiadas);
          button_handler_uj(2, "enabled");
        }
      }
      if (command == "save") {
        kiadas = selection_returner(0).innerHTML;

        if (kiadas == "Classic - EN") {
          localStorage.setItem("Edition", "Classic - EN");
          localStorage.setItem("Suspects", ["Green", "Mustard", "Orchid", "Peacock", "Plum", "Scarlet"]);
          localStorage.setItem("Weapons", ["Candlestick", "Dagger", "Lead Pipe", "Revolver", "Rope", "Wrench"]);
          localStorage.setItem("Rooms", ["Ballroom", "Bathroom", "Billiard Room", "Conservatory", "Dining Room", "Kitchen", "Library", "Lounge", "Study"]);
        }
        if (kiadas == "Classic - HU") {
          localStorage.setItem("Edition", "Classic - HU");
          localStorage.setItem("Suspects", ["Green", "Mustard", "Peacock", "Plum", "Scarlet", "White"]);
          localStorage.setItem("Weapons", ["Balta", "Gyertyatartó", "Kés", "Kötél", "Méreg", "Pisztoly", "Súlyzó", "Trófea", "Ütő"]);
          localStorage.setItem("Rooms", ["Csillagvizsgáló", "Étkező", "Fürdő", "Hall", "Konyha", "Moziterem", "Nappali", "Terasz", "Vendégház"]);
        }

        if (kiadas == "Classic - US") {
          localStorage.setItem("Edition", "Classic - US");
          localStorage.setItem("Suspects", ["Green", "Mustard", "Peacock", "Plum", "Scarlet", "White"]);
          localStorage.setItem("Weapons", ["Candlestick", "Dagger", "Lead Pipe", "Pistol", "Rope", "Wrench"]);
          localStorage.setItem("Rooms", ["Bathroom", "Bedroom", "Courtyard", "Dining Room", "Game Room", "Garage", "Kitchen", "Living Room", "Study"]);
        }
        if (kiadas == "Charlie and the Chocolate Factory") {
          localStorage.setItem("Edition", "Charlie and the Chocolate Factory");
          localStorage.setItem("Suspects", ["Augustus Gloop", "Charlie Bucket", "Mike Teavee", "Oompa-Loompa", "Veruca Salt", "Violet Beauregarde"]);
          localStorage.setItem("Weapons", ["Fizzy Drink", "Marshmallow Pillow", "Mint Jujube", "Square Sweet", "Toffe Apple", "Wonka's Delight"]);
          localStorage.setItem("Rooms", ["Chocolate River", "Chocolate Room", "Chocolate-TV Room", "Fudge Room", "Incinerator", "Inventing Room", "Juicing Room", "Nut Room", "Rock-Candy Mine"]);
        }
        if (kiadas == "Scooby Doo!") {
          localStorage.setItem("Edition", "Scooby Doo!");
          localStorage.setItem("Suspects", ["Daphne", "Fred", "Mrs. White", "Scooby-Doo", "Shaggy", "Velma"]);
          localStorage.setItem("Weapons", ["Clown's Bomb", "Doctor's Staff", "Gypsy's Spell Book", "Monster's Chain", "Redbeard's Sword", "Robot's Ray Gun"]);
          localStorage.setItem("Rooms", ["Ballroom", "Billiard Room", "Conservatory", "Courtyard", "Dining Room", "Graveyard", "Kitchen", "Library", "Lounge"]);
        }

        localStorage.setItem("Setup step", 0);

        selection_unhider(1);
      }
    }

    function lepes_1(command) {
      if (command == "load") {
        document.getElementById("dinamikus_szoveg").textContent = "No. of Players";
        document.getElementsByClassName("draggable")[0].style.display = "none";
        jatekos_szamok = localStorage.getItem("Player limit").split(",").map(Number);
        jatekos_szam = localStorage.getItem("Number of players");
        div_creator(1, jatekos_szamok, "tile");
        selection_handler(1);
        if (!jatekos_szam) {
          button_handler_uj(2, "disabled");
        }
        if (jatekos_szam) {
          selection_returner(1, jatekos_szam);
          button_handler_uj(2, "enabled");
        }
      }

      if (command == "save") {
        jatekos_szam = selection_returner(1).innerHTML;
        localStorage.setItem("Number of players", jatekos_szam);
        localStorage.setItem("Setup step", 1);
        selection_unhider(2);
      }
    }

    function lepes_2(command) {
      if (command == "load") {
        document.getElementById("step2").style.display = "block";
        document.getElementById("dinamikus_szoveg").textContent = "Players";
        document.getElementsByClassName("draggable")[0].style.display = "grid";

        jatekos_szam = parseInt(localStorage.getItem("Number of players"));
        jatekosok_elobbi = localStorage.getItem("Players");
        let jatekosok;
        if (!jatekosok_elobbi) {
          jatekosok = ["You", "Dave", "Gerald", "Sally", "Franklin", "Susan"].slice(0, jatekos_szam);
        }
        if (jatekosok_elobbi) {
          jatekosok = jatekosok_elobbi.split(",");
          if (jatekosok.length < jatekos_szam) {
            jatekosok = jatekosok.concat(["Dave", "Gerald", "Sally", "Franklin", "Susan"].slice(0, jatekos_szam - jatekosok.length));
          }
          button_handler_uj(2, "enabled");
        }
        kartyak = [...localStorage.getItem("Suspects").split(","), ...localStorage.getItem("Weapons").split(","), ...localStorage.getItem("Rooms").split(",")];
        input_container = document.getElementById("step2");

        for (let i = 0; i < jatekos_szam; i++) {
          let player_div = document.createElement("div");
          player_div.classList.add("draggable");
          player_div.setAttribute("draggable", "true");

          let input = document.createElement("input");
          input.type = "text";
          input.placeholder = jatekosok[i];
          if (i === 0) {
            input.value = "You";
            input.readOnly = true;
          }
          if (jatekosok_elobbi) {
            input.value = jatekosok[i];
            if (jatekosok[i] == "You") {
              input.readOnly = true;
            }
          }

          let dropdown = document.createElement("select");
          for (let j = 1; j <= 7; j++) {
            let option = document.createElement("option");
            option.value = j;
            option.text = j;
            dropdown.appendChild(option);
          }
          dropdown.value = parseInt(Math.floor((kartyak.length - 3) / jatekos_szam));
          let kartyaszamok;
          if (jatekosok_elobbi) {
            kartyaszamok = localStorage.getItem("Player cards").split(",");
            dropdown.value = kartyaszamok[i];
          }

          player_div.appendChild(input);
          player_div.appendChild(dropdown);

          let drag_svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
          drag_svg.setAttribute("xmlns", "http://www.w3.org/2000/svg");
          drag_svg.setAttribute("viewBox", "0 -960 960 960");
          drag_svg.setAttribute("style", "width: var(--drag-svg-meret); height: var(--drag-svg-meret); fill: var(--masodlagos-szin)");

          let path = document.createElementNS("http://www.w3.org/2000/svg", "path");
          path.setAttribute("d", "M160-360v-80h640v80H160Zm0-160v-80h640v80H160Z");
          drag_svg.appendChild(path);

          player_div.appendChild(drag_svg);
          input_container.appendChild(player_div);
        }
      }

      if (command == "save") {
        input_players = input_container.querySelectorAll(".draggable");
        banned_names = ["None", "none", "Denied", "denied", "No one", "Leftover cards", "Leftover card", "Possible", ",", " ", ...forditasok.flat()];
        cards_limit = kartyak.length - 3;
        player_names_helper = [];
        player_cards_helper = [];
        isValid = true;

        input_players.forEach((element) => {
          input_name = element.querySelector("input");
          input_card = element.querySelector("select");
          input_name_trimmed = input_name.value.trim();

          if (!input_name_trimmed || banned_names.includes(input_name_trimmed) || player_names_helper.includes(input_name_trimmed) || input_name_trimmed.includes(",")) {
            isValid = false;
            element.style.backgroundColor = "var(--invalid-szin)";
          } else {
            element.style.backgroundColor = "var(--tile-szin-atlatszo)";
            //  element.style.backgroundColor = "var(--valid-szin)";

            player_names_helper.push(input_name_trimmed);
          }

          player_cards_helper.push(parseInt(input_card.value));
        });

        szamokOK = player_cards_helper.reduce((a, b) => a + b, 0) <= cards_limit;
        jatekosokOK = player_names_helper.length == jatekos_szam;

        jatekosszam_szoveg = document.querySelectorAll(".draggable h3")[1];
        jatekosok_szoveg = document.querySelectorAll(".draggable h3")[0];

        const osszes_kartya = [...localStorage.getItem("Suspects").split(","), ...localStorage.getItem("Weapons").split(","), ...localStorage.getItem("Rooms").split(",")];
        jatekosszam_szoveg.title = `The amount of cards cannot exceed ${osszes_kartya.length - 3}.`;
        jatekosok_szoveg.title = "Unique, non-empty names allowed.";

        if (!szamokOK) {
          if (jatekosszam_szoveg.textContent.includes("✔︎")) {
            jatekosszam_szoveg.textContent = jatekosszam_szoveg.textContent.replace("✔︎", "");
          }
          if (!jatekosszam_szoveg.textContent.includes("✘")) {
            jatekosszam_szoveg.textContent += " ✘";
          }
        } else if (szamokOK) {
          if (jatekosszam_szoveg.textContent.includes("✘")) {
            jatekosszam_szoveg.textContent = jatekosszam_szoveg.textContent.replace("✘", "");
          }
          if (!jatekosszam_szoveg.textContent.includes("✔︎")) {
            jatekosszam_szoveg.textContent += " ✔︎";
          }
        }

        if (!jatekosokOK) {
          if (jatekosok_szoveg.textContent.includes("✔︎")) {
            jatekosok_szoveg.textContent = jatekosok_szoveg.textContent.replace("✔︎", "");
          }
          if (!jatekosok_szoveg.textContent.includes("✘")) {
            jatekosok_szoveg.textContent += " ✘";
          }
        } else if (jatekosokOK) {
          if (jatekosok_szoveg.textContent.includes("✘")) {
            jatekosok_szoveg.textContent = jatekosok_szoveg.textContent.replace("✘", "");
          }
          if (!jatekosok_szoveg.textContent.includes("✔︎")) {
            jatekosok_szoveg.textContent += " ✔︎";
          }
        }

        if (isValid && szamokOK && jatekosokOK) {
          localStorage.setItem("Players", player_names_helper.join(","));
          localStorage.setItem("Player cards", player_cards_helper.join(","));
          localStorage.setItem("Setup step", 2);
          selection_unhider(3);
        }
      }

      let dragged_item = null;

     // Mouse drag start
input_container.addEventListener("dragstart", (e) => {
  // Ensure the parent element (not the child) is being dragged
  dragged_item = e.target.closest('.draggable');
  e.dataTransfer.effectAllowed = "move";
});

// Touch start equivalent to drag start
input_container.addEventListener("touchstart", (e) => {
  // Ensure the parent element (not the child) is being dragged
  dragged_item = e.target.closest('.draggable');
});

      // Mouse drag over
      input_container.addEventListener("dragover", (e) => {
        e.preventDefault();
        handleDragOver(e.clientY);
      });

      // Touch move equivalent to drag over
      input_container.addEventListener("touchmove", (e) => {
        e.preventDefault();
        const touchLocation = e.targetTouches[0];
        handleDragOver(touchLocation.clientY);
      });

      function handleDragOver(y) {
        const afterElement = drag_helper(input_container, y);
        if (afterElement == null) {
          input_container.appendChild(dragged_item);
        } else {
          input_container.insertBefore(dragged_item, afterElement);
        }
      }

      function drag_helper(input_container, y) {
        const draggableElements = [...input_container.querySelectorAll(".draggable:not(.dragging)")];

        return draggableElements.reduce(
          (closest, child) => {
            const box = child.getBoundingClientRect();
            const offset = y - box.top - box.height / 2;
            if (offset < 0 && offset > closest.offset) {
              return { offset: offset, element: child };
            } else {
              return closest;
            }
          },
          { offset: Number.NEGATIVE_INFINITY }
        ).element;
      }
    }

    function lepes_3(command) {
      if (command == "load") {
        document.getElementById("dinamikus_szoveg").textContent = "Your cards";
        document.getElementsByClassName("draggable")[0].style.display = "none";
        kategoriak = ["Suspects", "Weapons", "Rooms"];

        kategoriak.forEach((kategoriak, index) => {
          items = localStorage.getItem(kategoriak).split(",");
          details = document.createElement("details");
          details.classList.add("tile");
          summary = document.createElement("summary");
          summary.textContent = kategoriak;
          details.appendChild(summary);

          items.forEach((item) => {
            label = document.createElement("label");
            checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.value = item;
            label.appendChild(checkbox);
            label.appendChild(document.createTextNode(item));
            details.appendChild(label);
          });

          document.getElementById("step3").appendChild(details);
        });

        document.querySelectorAll("#step3 details").forEach((details) => {
          details.addEventListener("toggle", function () {
            if (details.open) {
              details.classList.add("selected");
              details.classList.remove("inactive");
              document.querySelectorAll("#step3 details").forEach((otherDetails) => {
                if (otherDetails !== details) {
                  otherDetails.open = false;
                  otherDetails.classList.remove("selected");
                  otherDetails.classList.add("inactive");
                }
              });
            } else {
              details.classList.remove("selected");
              details.classList.add("inactive");
            }
          });
        });

        kartyak_sajat = localStorage.getItem("Own cards");
        if (kartyak_sajat) {
          kartyak_sajat.split(",").forEach((kartya) => {
            document.querySelectorAll("#step3 input").forEach((input) => {
              if (input.value == kartya) {
                input.checked = true;
                input.parentElement.classList.add("selected");
              }
            });
          });
        }

        kartyaszam_sajat = localStorage.getItem("Player cards").split(",")[localStorage.getItem("Players").split(",").indexOf("You")];
        selectedCheckboxes = document.querySelectorAll("#step3 input[type='checkbox']:checked").length;
        if (selectedCheckboxes == parseInt(kartyaszam_sajat)) {
          button_handler_uj(2, "enabled");
        } else {
          button_handler_uj(2, "disabled");
        }
        document.querySelectorAll("#step3 input[type='checkbox']").forEach((checkbox) => {
          checkbox.addEventListener("change", function () {
            const selectedCheckboxes = document.querySelectorAll("#step3 input[type='checkbox']:checked").length;
            if (selectedCheckboxes == parseInt(kartyaszam_sajat)) {
              button_handler_uj(2, "enabled");
            } else {
              button_handler_uj(2, "disabled");
            }

            if (checkbox.checked) {
              checkbox.parentElement.classList.add("selected");
            } else {
              checkbox.parentElement.classList.remove("selected");
            }
          });
        });

        function updateCheckedCount() {
          document.querySelectorAll("#step3 details").forEach((details) => {
            const checkedCount = details.querySelectorAll("input[type='checkbox']:checked").length;
            let summary = details.querySelector("summary");
            let countSpan = summary.querySelector(".circled");

            if (checkedCount > 0) {
              if (!countSpan) {
                countSpan = document.createElement("span");
                countSpan.classList.add("circled");
                summary.appendChild(countSpan);
              }
              countSpan.textContent = ` ${checkedCount}`;
            } else if (countSpan) {
              summary.removeChild(countSpan);
            }
          });
        }
        document.querySelectorAll("#step3 label").forEach((label) => {
          label.classList.add("subtile");
        });
        updateCheckedCount();

        document.querySelectorAll("#step3 input[type='checkbox']").forEach((checkbox) => {
          checkbox.addEventListener("change", updateCheckedCount);
        });
      }
      if (command == "save") {
        kartyak_sajat = [];
        document.querySelectorAll("#step3 input[type='checkbox']:checked").forEach((checkbox) => {
          kartyak_sajat.push(checkbox.value);
        });
        localStorage.setItem("Own cards", kartyak_sajat.join(","));
        localStorage.setItem("Setup step", 3);
        selection_unhider(4);
      }
    }

    function lepes_4(command) {
      if (command == "load") {
        if (localStorage.getItem("Accusation Assist")) {
          const exclamation = document.createElement("span");
          exclamation.textContent = "!";
          exclamation.classList.add("circled");
          exclamation.title = "Card in the envelope found!";

          Array.from(document.querySelectorAll("#step4 .tile"))
            .find((el) => el.getAttribute("onclick").includes("clue-sheet.html"))
            .appendChild(exclamation);
        }

        document.getElementById("dinamikus_szoveg").textContent = "Menu";
        document.getElementsByClassName("draggable")[0].style.display = "none";
        selection_handler(4);
        kerdesek = localStorage.getItem("Questions");
        if (!kerdesek) {
          Array.from(document.querySelectorAll("#step4 .tile"))
            .find((el) => el.getAttribute("onclick").includes("delete-question.html"))
            .classList.add("disabled");
        } else {
          Array.from(document.querySelectorAll("#step4 .tile"))
            .find((el) => el.getAttribute("onclick").includes("delete-question.html"))
            .classList.remove("disabled");
        }
      }
    }
  </script>
  <script src="code/jatek_logika.js"></script>
</html>
